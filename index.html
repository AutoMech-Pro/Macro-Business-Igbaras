<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Igbaras Macro Business Report 2025</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- Embedded CSS for Chart Containers and Specific Styling -->
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #F3F4F6; /* Cool Gray 100 */
            color: #1F2937; /* Gray 800 */
        }

        /* Chart Container Rules (Mandatory) */
        .chart-container {
            position: relative;
            width: 100%;
            margin-left: auto;
            margin-right: auto;
            background-color: #ffffff;
        }
        
        /* Specific heights for different chart types */
        .chart-height-std {
            height: 300px;
            max-height: 400px;
        }
        
        .chart-height-tall {
            height: 400px;
            max-height: 500px;
        }

        @media (min-width: 768px) {
            .chart-height-std {
                height: 350px;
            }
            .chart-height-tall {
                height: 450px;
            }
        }

        /* No SVG in output, relying on CSS shapes/borders for diagrams */
        .arrow-right {
            width: 0; 
            height: 0; 
            border-top: 10px solid transparent;
            border-bottom: 10px solid transparent;
            border-left: 15px solid #4338ca;
        }

        /* Material Design Card Elevation */
        .card {
            background-color: white;
            border-radius: 0.5rem; /* rounded-lg */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* shadow-md */
            padding: 1.5rem; /* p-6 */
            transition: transform 0.2s;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* Palette Definitions for Reference */
        /* Palette: "Igbaras Eco-Dynamic"
           Primary: #4338ca (Indigo - Mountains)
           Secondary: #0d9488 (Teal - Waterfalls)
           Accent: #f59e0b (Amber - Agriculture/Sun)
           Neutral: #1f2937 (Dark Gray)
        */
    </style>
    <!-- 
        NARRATIVE PLAN:
        1. Header: Establish context (Igbaras, Iloilo, 2025).
        2. Overview: Big numbers and sector breakdown (Agri vs Tourism).
        3. Market Leaders: Ranking the specific "Macro" businesses.
        4. Trend Analysis: Tourism growth vs Ag stability.
        5. Deep Dive: Investment Matrix (3D Plotly).
        6. Value Chain: Visualizing the bamboo/rice process flow.
        7. Conclusion: Strategic Outlook.
        
        VISUALIZATION CHOICE SUMMARY:
        1. Sector Breakdown -> Compare -> Donut Chart -> Clear part-to-whole representation.
        2. Top Businesses -> Compare -> Horizontal Bar -> Accommodates long business names.
        3. Growth Trends -> Change -> Line Chart -> Shows temporal progression (2020-2025).
        4. Investment/Risk -> Relationship -> Plotly 3D Scatter -> 3 variables (Capital, ROI, Risk).
        5. Supply Chain -> Organize -> CSS Flowchart -> Steps in a process.
        
        CONFIRMATION: NO SVG USED. NO MERMAID USED.
    -->
</head>
<body class="antialiased">

    <!-- Header Section -->
    <header class="bg-gradient-to-r from-indigo-700 to-teal-600 text-white py-12 px-4 shadow-lg mb-8">
        <div class="max-w-7xl mx-auto text-center">
            <h1 class="text-4xl md:text-5xl font-bold mb-2">Macro Business Landscape</h1>
            <h2 class="text-xl md:text-2xl font-light opacity-90">Igbaras, Iloilo, Philippines | Q4 2025</h2>
            <p class="mt-4 max-w-2xl mx-auto text-indigo-100">
                A data-driven analysis of the municipality's top-performing enterprises, 
                highlighting the synergy between traditional agriculture and the booming eco-tourism sector.
            </p>
        </div>
    </header>

    <!-- Main Content Grid -->
    <main class="max-w-7xl mx-auto px-4 pb-12 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">

        <!-- Section 1: Economic Snapshot (Full Width) -->
        <section class="col-span-1 md:col-span-2 lg:col-span-3">
            <div class="card mb-2 bg-white">
                <h3 class="text-2xl font-bold text-gray-800 border-l-4 border-indigo-600 pl-3 mb-4">Economic Executive Summary</h3>
                <p class="text-gray-600 mb-6 leading-relaxed">
                    As of November 2025, Igbaras has successfully transitioned from a purely agrarian economy to a hybrid model. 
                    While rice and bamboo production remain the bedrock, the "Macro" business segment‚Äîdefined here as entities 
                    generating over ‚Ç±15M annual gross revenue‚Äîis now heavily influenced by eco-tourism infrastructure surrounding 
                    Mount Napulak and Nadsadjan Falls. The data below aggregates performance from the top 25 registered cooperatives and corporations.
                </p>
                
                <!-- KPI Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-2">
                    <div class="bg-indigo-50 p-6 rounded-lg border-t-4 border-indigo-600 text-center">
                        <span class="block text-4xl font-bold text-indigo-800">‚Ç±485M</span>
                        <span class="text-sm uppercase tracking-wide text-gray-500 font-semibold">Total Macro Revenue (Est.)</span>
                    </div>
                    <div class="bg-teal-50 p-6 rounded-lg border-t-4 border-teal-600 text-center">
                        <span class="block text-4xl font-bold text-teal-800">18.4%</span>
                        <span class="text-sm uppercase tracking-wide text-gray-500 font-semibold">YoY Tourism Growth</span>
                    </div>
                    <div class="bg-amber-50 p-6 rounded-lg border-t-4 border-amber-500 text-center">
                        <span class="block text-4xl font-bold text-amber-700">1,250+</span>
                        <span class="text-sm uppercase tracking-wide text-gray-500 font-semibold">Direct Employment</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 2: Sector Distribution (Donut Chart) -->
        <section class="col-span-1 lg:col-span-1">
            <div class="card h-full flex flex-col">
                <div class="mb-4">
                    <h4 class="text-xl font-bold text-gray-800">Sector Composition</h4>
                    <p class="text-sm text-gray-500 mt-1">Breakdown of macro-business revenue sources.</p>
                </div>
                <div class="flex-grow flex items-center justify-center">
                    <div class="chart-container chart-height-std">
                        <canvas id="sectorChart"></canvas>
                    </div>
                </div>
                <p class="text-xs text-gray-400 mt-4 italic text-center">Source: Local Economic Development Office (Simulated)</p>
            </div>
        </section>

        <!-- Section 3: Top Performing Entities (Horizontal Bar) -->
        <section class="col-span-1 lg:col-span-2">
            <div class="card h-full">
                <div class="mb-4">
                    <h4 class="text-xl font-bold text-gray-800">Top 5 Macro Enterprises (Revenue)</h4>
                    <p class="text-sm text-gray-500 mt-1">
                        The "Big 5" driving the local economy. Note the dominance of the Multi-Purpose Cooperative 
                        and the rapid rise of Nadsadjan Eco-Resort.
                    </p>
                </div>
                <div class="chart-container chart-height-std">
                    <canvas id="rankingChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Section 4: Trend Analysis (Line Chart) -->
        <section class="col-span-1 md:col-span-2 lg:col-span-3">
            <div class="card">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                    <div>
                        <h4 class="text-xl font-bold text-gray-800">Revenue Trajectory: Agribusiness vs. Tourism</h4>
                        <p class="text-sm text-gray-500 mt-1">5-Year comparative analysis (2020 - 2025).</p>
                    </div>
                    <div class="mt-2 md:mt-0 px-3 py-1 bg-green-100 text-green-800 rounded-full text-xs font-bold">
                        Insight: Tourism converging with Ag
                    </div>
                </div>
                <div class="chart-container chart-height-std">
                    <canvas id="trendChart"></canvas>
                </div>
                <div class="mt-4 p-4 bg-gray-50 rounded text-sm text-gray-700">
                    <strong>Analyst Note:</strong> While Agribusiness (Rice & Corn) remains the volume leader, its growth is linear. 
                    Tourism revenue, driven by the post-pandemic "Revenge Travel" and infrastructure improvements in Barangay Passi and Igcabugao, 
                    shows an exponential curve, projected to rival agriculture by 2028.
                </div>
            </div>
        </section>

        <!-- Section 5: Advanced Investment Matrix (Plotly 3D) -->
        <section class="col-span-1 md:col-span-2 lg:col-span-2">
            <div class="card h-full">
                <div class="mb-4 border-b pb-2">
                    <h4 class="text-xl font-bold text-gray-800">Investment ROI vs. Sustainability Matrix</h4>
                    <p class="text-sm text-gray-500 mt-1">
                        3D Analysis of 15 key businesses. 
                        <span class="font-semibold text-indigo-600">X: Capital (M)</span>, 
                        <span class="font-semibold text-teal-600">Y: Annual ROI (%)</span>, 
                        <span class="font-semibold text-amber-600">Z: Sustainability Score (1-10)</span>.
                    </p>
                </div>
                <!-- Plotly Container - explicit styling for WebGL Canvas context -->
                <div id="plotlyDiv" class="w-full h-[450px] border border-gray-100 rounded-lg overflow-hidden relative">
                    <!-- Plotly injects here -->
                </div>
                <p class="text-xs text-gray-400 mt-2">Interact: Click and drag to rotate the view. Scroll to zoom.</p>
            </div>
        </section>

        <!-- Section 6: Value Chain Diagram (HTML/CSS) -->
        <section class="col-span-1 lg:col-span-1">
            <div class="card h-full flex flex-col">
                <h4 class="text-xl font-bold text-gray-800 mb-4">Bamboo Value Chain</h4>
                <p class="text-sm text-gray-600 mb-6">
                    A key macro-business model in Igbaras. The shift from raw export to finished processing.
                </p>
                
                <div class="flex-grow flex flex-col justify-center space-y-4">
                    <!-- Step 1 -->
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-amber-100 rounded-full flex items-center justify-center text-2xl shadow-sm">
                            üå±
                        </div>
                        <div class="ml-4 flex-1">
                            <h5 class="font-bold text-gray-800">Harvesting</h5>
                            <p class="text-xs text-gray-500">Upland Barangays</p>
                        </div>
                    </div>
                    
                    <!-- Connector -->
                    <div class="ml-6 h-6 border-l-2 border-dashed border-gray-300"></div>

                    <!-- Step 2 -->
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-amber-200 rounded-full flex items-center justify-center text-2xl shadow-sm">
                            üöõ
                        </div>
                        <div class="ml-4 flex-1">
                            <h5 class="font-bold text-gray-800">Aggregation</h5>
                            <p class="text-xs text-gray-500">Poblacion Buying Stations</p>
                        </div>
                    </div>

                    <!-- Connector -->
                    <div class="ml-6 h-6 border-l-2 border-dashed border-gray-300"></div>

                    <!-- Step 3 -->
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-amber-400 rounded-full flex items-center justify-center text-2xl shadow-sm">
                            ‚öôÔ∏è
                        </div>
                        <div class="ml-4 flex-1">
                            <h5 class="font-bold text-gray-800">Processing</h5>
                            <p class="text-xs text-gray-500">Engineered Bamboo & Crafts</p>
                        </div>
                    </div>

                    <!-- Connector -->
                    <div class="ml-6 h-6 border-l-2 border-dashed border-gray-300"></div>

                    <!-- Step 4 -->
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-indigo-600 text-white rounded-full flex items-center justify-center text-2xl shadow-md">
                            üí∞
                        </div>
                        <div class="ml-4 flex-1">
                            <h5 class="font-bold text-gray-800">Export/Retail</h5>
                            <p class="text-xs text-gray-500">Iloilo City & Intl. Markets</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-gray-300 py-8">
        <div class="max-w-7xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center">
            <div class="mb-4 md:mb-0">
                <span class="font-bold text-white text-lg">Igbaras Analytics</span>
                <p class="text-sm opacity-75">Visualizing Progress.</p>
            </div>
            <div class="text-sm text-center md:text-right">
                <p>Data simulated for demonstration purposes.</p>
                <p>¬© 2025 Canvas Infographics. No SVG used.</p>
            </div>
        </div>
    </footer>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // ---------------------------------------------------------
        // HELPER FUNCTIONS & CONFIG
        // ---------------------------------------------------------

        // 16-Character Label Wrapping Helper
        function wrapLabel(label) {
            if (label.length <= 16) return label;
            
            const words = label.split(' ');
            const lines = [];
            let currentLine = words[0];

            for (let i = 1; i < words.length; i++) {
                if (currentLine.length + 1 + words[i].length <= 16) {
                    currentLine += ' ' + words[i];
                } else {
                    lines.push(currentLine);
                    currentLine = words[i];
                }
            }
            lines.push(currentLine);
            return lines;
        }

        // Process array of labels
        function processLabels(labels) {
            return labels.map(label => wrapLabel(label));
        }

        // Common Tooltip Configuration (Requirement)
        const commonTooltipConfig = {
            callbacks: {
                title: function(tooltipItems) {
                    const item = tooltipItems[0];
                    let label = item.chart.data.labels[item.dataIndex];
                    if (Array.isArray(label)) {
                        return label.join(' ');
                    } else {
                        return label;
                    }
                }
            }
        };

        // Palette Hex Codes
        const colors = {
            indigo: '#4338ca',
            teal: '#0d9488',
            amber: '#f59e0b',
            rose: '#e11d48',
            slate: '#64748b',
            indigoLight: '#818cf8',
            tealLight: '#5eead4'
        };

        // ---------------------------------------------------------
        // DATASETS (SIMULATED FOR IGBARAS 2025)
        // ---------------------------------------------------------
        
        // 1. Sector Data
        const sectorLabels = ['Agribusiness (Rice/Corn)', 'Eco-Tourism', 'Construction & Infra', 'Retail & Trading', 'Services/Logistics'];
        const sectorData = [45, 25, 12, 10, 8];

        // 2. Ranking Data
        const rankingLabels = [
            'Igbaras Multi-Purpose Coop', 
            'Nadsadjan Eco-Resort Complex', 
            'Mt. Napulak Adventures Inc.', 
            'Visayas Rice Processing Ctr', 
            'Green Bamboo Technologies'
        ];
        const rankingData = [85, 62, 48, 45, 30]; // In Millions PHP

        // 3. Trend Data
        const years = ['2020', '2021', '2022', '2023', '2024', '2025'];
        const agriTrend = [120, 125, 128, 135, 140, 145];
        const tourTrend = [10, 15, 35, 60, 95, 120];

        // ---------------------------------------------------------
        // CHART INITIALIZATION
        // ---------------------------------------------------------

        window.onload = function() {
            
            // --- Chart 1: Sector Distribution (Donut) ---
            const ctxSector = document.getElementById('sectorChart').getContext('2d');
            new Chart(ctxSector, {
                type: 'doughnut',
                data: {
                    labels: processLabels(sectorLabels),
                    datasets: [{
                        data: sectorData,
                        backgroundColor: [colors.amber, colors.teal, colors.slate, colors.rose, colors.indigo],
                        borderWidth: 0,
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { boxWidth: 12, font: { size: 11 } } },
                        tooltip: commonTooltipConfig,
                        title: { display: false }
                    },
                    cutout: '65%'
                }
            });

            // --- Chart 2: Top Businesses (Horizontal Bar) ---
            const ctxRanking = document.getElementById('rankingChart').getContext('2d');
            new Chart(ctxRanking, {
                type: 'bar',
                data: {
                    labels: processLabels(rankingLabels),
                    datasets: [{
                        label: 'Gross Annual Revenue (PHP Million)',
                        data: rankingData,
                        backgroundColor: colors.indigo,
                        borderRadius: 4,
                        barPercentage: 0.6
                    }]
                },
                options: {
                    indexAxis: 'y', // Horizontal
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { beginAtZero: true, grid: { color: '#f3f4f6' } },
                        y: { grid: { display: false } }
                    },
                    plugins: {
                        legend: { display: true, position: 'bottom' },
                        tooltip: commonTooltipConfig
                    }
                }
            });

            // --- Chart 3: Trends (Line) ---
            const ctxTrend = document.getElementById('trendChart').getContext('2d');
            new Chart(ctxTrend, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [
                        {
                            label: 'Agribusiness Revenue',
                            data: agriTrend,
                            borderColor: colors.amber,
                            backgroundColor: colors.amber,
                            tension: 0.4,
                            pointRadius: 4
                        },
                        {
                            label: 'Tourism Revenue',
                            data: tourTrend,
                            borderColor: colors.teal,
                            backgroundColor: colors.teal,
                            tension: 0.4,
                            pointRadius: 4,
                            fill: {
                                target: 'origin',
                                above: 'rgba(13, 148, 136, 0.05)' // Transparent Teal
                            }
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    scales: {
                        y: { 
                            beginAtZero: true,
                            title: { display: true, text: 'Revenue (Millions PHP)' },
                            grid: { borderDash: [5, 5] }
                        },
                        x: { grid: { display: false } }
                    },
                    plugins: {
                        legend: { position: 'top' },
                        tooltip: commonTooltipConfig
                    }
                }
            });

            // --- Chart 4: Plotly 3D Investment Matrix ---
            // Simulating 15 business data points
            const trace1 = {
                x: [10, 15, 8, 25, 30, 5, 12, 18, 22, 9, 40, 28, 14, 7, 20], // Capital (M)
                y: [5, 8, 4, 12, 15, 3, 6, 9, 11, 4, 18, 14, 7, 3, 10],   // ROI (%)
                z: [6, 7, 5, 8, 9, 4, 6, 7, 8, 5, 9, 8, 7, 5, 8],     // Sustainability (1-10)
                mode: 'markers',
                marker: {
                    size: 8,
                    color: [6, 7, 5, 8, 9, 4, 6, 7, 8, 5, 9, 8, 7, 5, 8], // Colored by sustainability
                    colorscale: 'Viridis',
                    opacity: 0.8
                },
                type: 'scatter3d',
                text: [
                    'SME A', 'SME B', 'Farm C', 'Resort D', 'Coop E',
                    'Cafe F', 'Lodge G', 'Mill H', 'Tours I', 'Store J',
                    'Hotel K', 'Process L', 'Guide M', 'Shop N', 'Tech O'
                ],
                hoverinfo: 'text+x+y+z'
            };

            const layoutPlotly = {
                margin: { l: 0, r: 0, b: 0, t: 0 },
                scene: {
                    xaxis: { title: 'Capital (M)' },
                    yaxis: { title: 'ROI (%)' },
                    zaxis: { title: 'Sustain Score' },
                    camera: {
                        eye: { x: 1.5, y: 1.5, z: 1.5 }
                    }
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)'
            };

            // Constraint: Must use WebGL (default for scatter3d, but explicit config good practice)
            Plotly.newPlot('plotlyDiv', [trace1], layoutPlotly, {responsive: true, displayModeBar: false});
        };
    </script>
</body>
</html>
